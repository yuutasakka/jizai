# API バージョニング方針（v1 / v2）

本書は、Breaking Change を安全に提供するためのAPIバージョニングと廃止（EOL）手順を定めます。

## 基本指針
- パスでバージョンを明示（例: `/v1/...`, `/v2/...`）。
- Breaking Change を含むときのみメジャー（vN）を上げる。後方互換の追加はv据え置き。
- v1とv2は一定期間並行稼働。EOLは90日以上前に周知。

## 互換性ポリシー
- 同一エンドポイント内でレスポンスの必須フィールドを削除/型変更しない。
- 追加フィールドは許容（クライアントは許容的パーサで実装）。
- エラーコードは辞書で管理し、v間での名称衝突を避ける。

## 廃止の流れ
1. 仕様策定: `docs/openapi.yaml` に v2 仕様を追加。
2. 実装: `/v2/...` で新実装提供。機能パリティ到達まで並行稼働。
3. アナウンス: README/CHANGELOG/Release Note/運用通知でEOL日付を告知（>=90日）。
4. フィードバック収集: CSP/アクセスログ/メトリクスで v1 利用状況を可視化。
5. 停止: v1 を段階的にトラフィックシフト→停止。Runbook に切替手順を記録。

## クライアント連携
- OpenAPI を単一ソースとし、型生成やテストを自動化（contract test）。
- SDK/クライアントのメジャー更新時は、既定で最新APIに追従。

## チェックリスト（APIバージョニング）
- [x] 方針ドキュメント整備
- [ ] `docs/openapi.yaml` に v2 スタブ追加
- [ ] EOL 手順を Runbook に追記
