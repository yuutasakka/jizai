# Backend Environment Variables (Express + Production)
# Copy to .env.production and fill in actual values

# =============================================================================
# Supabase Configuration (Required)
# =============================================================================
# Supabase project URL
SUPABASE_URL=https://your-project.supabase.co

# Supabase anon key (public key - also available on frontend)
SUPABASE_ANON_KEY=your_actual_anon_key_here

# Supabase service key (SECRET - server-side only, bypasses RLS)
SUPABASE_SERVICE_KEY=your_actual_service_role_key_here

# Supabase JWT secret (for JWT verification if needed)
SUPABASE_JWT_SECRET=your_jwt_secret_here

# =============================================================================
# Server Configuration
# =============================================================================
PORT=3001
NODE_ENV=production

# =============================================================================
# CORS & Security Configuration
# =============================================================================
# Comma-separated list of allowed origins for CORS
ORIGIN_ALLOWLIST=https://yourdomain.com,https://app.yourdomain.com,https://jizai.vercel.app

# Main site URL for CORS configuration
NEXT_PUBLIC_SITE_URL=https://yourdomain.com

# =============================================================================
# Security Keys (GENERATE NEW ONES FOR PRODUCTION!)
# =============================================================================
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_SECRET=generate_new_64_byte_key_here

# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
API_ENCRYPTION_KEY=generate_new_32_byte_key_here

# Admin token for protected endpoints (32+ characters recommended)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ADMIN_TOKEN=generate_secure_admin_token_here

# =============================================================================
# External API Keys
# =============================================================================
# Gemini API key (image edits)
GEMINI_API_KEY=your_gemini_api_key_here
# Replicate API token (upscale)
REPLICATE_API_TOKEN=your_replicate_api_token_here
# Optional: specific model version for ESRGAN
# REPLICATE_MODEL_VERSION=nightmareai/real-esrgan:5c1f8f2c2f1c90b28a6a4e6c9fbd8b7df0a5a6f0e7c2d3b4f6c8a7b9d0e1f2a3

# =============================================================================
# Rate Limiting Configuration
# =============================================================================
# General rate limiting (requests per second)
RATE_LIMIT_RPS=10

# Edit functionality rate limiting
EDIT_RATE_LIMIT=5

# Purchase functionality rate limiting
PURCHASE_RATE_LIMIT=2

# Rate limit window in milliseconds (default: 15 minutes)
RATE_LIMIT_WINDOW_MS=900000

# Maximum requests per window (default: 1000)
RATE_LIMIT_MAX_REQUESTS=1000
DOWNLOAD_RATE_LIMIT=8           # Signed download requests (per minute)
UPSCALE_RATE_LIMIT=10           # Upscale requests (per minute)
UPSCALE_SRC_DOMAIN_ALLOWLIST=   # Optional: comma-separated domain allowlist for src_url

# =============================================================================
# App Store Configuration (iOS)
# =============================================================================
APPSTORE_BUNDLE_ID=com.yourcompany.jizai
APPSTORE_ENVIRONMENT=production
APPSTORE_SHARED_SECRET=your_app_store_shared_secret

# =============================================================================
# Application Configuration
# =============================================================================
APP_BUNDLE_ID=com.yourcompany.jizai

# =============================================================================
# Monitoring & Logging
# =============================================================================
LOG_LEVEL=info
ENABLE_AUDIT_LOGGING=true

# =============================================================================
# Performance Configuration
# =============================================================================
ENABLE_COMPRESSION=true
ENABLE_CACHING=true

# =============================================================================
# Security Notes
# =============================================================================
# ⚠️  CRITICAL SECURITY RULES:
# 1. NEVER expose SERVICE_KEY to frontend - it bypasses Row Level Security
# 2. ADMIN_TOKEN should be 32+ characters and securely generated
# 3. API keys should be stored in your deployment platform's secrets
# 4. Use ORIGIN_ALLOWLIST to restrict CORS to your actual domains
# 5. Rotate all keys before production deployment

# =============================================================================
# Deployment Notes
# =============================================================================
# For Vercel deployment:
# 1. Add all these variables to Vercel Environment Variables
# 2. Use Vercel CLI: vercel env add VARIABLE_NAME
# 3. Or use Vercel Dashboard: Project Settings → Environment Variables

# For other platforms:
# 1. Add to your platform's environment variables/secrets
# 2. Ensure proper security group/firewall rules
# 3. Use SSL/TLS for all communications
